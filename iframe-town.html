<html>
    <head>
        <title>IFRAME TOWN</title>
    </head>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }

        .title {
            width: 100%;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        .iframe-container {
            display: flex;
            width: 100%;
            height: 100%;
            justify-content: space-around;
        }

        iframe {
            width: 45%;
            height: 80%;
        }
    </style>
    <body>
        <div class="title">HOWDY PARDNER, WELCOME TO IFRAME TOWN!</div>
        <div class="iframe-container">
            <iframe src="/iframe-town-inner-1.html"></iframe>
            <iframe src="/iframe-town-inner-1.html"></iframe>
        </div>
                <script id="pendo-snippet">
                    function recursivelyAddSnippetToIframes(targetWindow) {
                        initializeSnippetOnTargetWindow(targetWindow);

                        const iframes = targetWindow.document.querySelectorAll('iframe');

                        iframes.forEach(iframe => {
                            const readyState = iframe.contentWindow.document.readyState;
                            if(readyState === 'loading') {
                                iframe.addEventListener('load', () => {
                                    initializeSnippetOnTargetWindow(iframe.contentWindow);
                                    recursivelyAddSnippetToIframes(iframe.contentWindow);
                                });
                            } else {
                                initializeSnippetOnTargetWindow(iframe.contentWindow);
                                recursivelyAddSnippetToIframes(iframe.contentWindow);
                            }
                        });
                    }

                    function initializeSnippetOnTargetWindow(window) {
                        const document = window.document;

                        // The idea here is that this is the literal copy-pasted snippet
                        // Thats why I override window/document above, so we can shift the target window/document of the
                        // snippet to the contentWindow/contentDocument of the iframe
                        (function (apiKey) {
                            (function (p, e, n, d, o) {

                                var v, w, x, y, z; o = p[d] = p[d] || {}; o._q = [];
                                v = ['initialize', 'identify', 'updateOptions', 'pageLoad']; for (w = 0, x = v.length; w < x; ++w)(function (m) {
                                    o[m] = o[m] || function () { o._q[m === v[0] ? 'unshift' : 'push']([m].concat([].slice.call(arguments, 0))); };
                                })(v[w]);
                                y = e.createElement(n); y.async = !0; y.src = 'https://pendo-dev-static.storage.googleapis.com/agent/static/' + apiKey + '/pendo.js';
                                z = e.getElementsByTagName(n)[0]; z.parentNode.insertBefore(y, z);
                            })(window, document, 'script', 'pendo');

                            var url = window.location.search;
                            var queryString = {};
                            // from https://stevenbenner.com/2010/03/javascript-regex-trick-parse-a-query-string-into-an-object/
                            url.replace(
                                new RegExp("([^?=&]+)(=([^&]*))?", "g"),
                                function ($0, $1, $2, $3) {
                                    queryString[$1] = $3;
                                }
                            );
                            pendo.initialize({
                                visitor: {
                                    id: queryString.visitor || 'testuser@pendo'
                                },
                                disableGuideCenterContentSearch: true,
                                apiKey: '0b8f789d-91df-4cc9-5016-3f7b2e0e8f51',
                                account: {
                                    id: 12345,
                                    city: 'Raleigh',
                                    zipCode: '27601'
                                }
                            });

                        })('0b8f789d-91df-4cc9-5016-3f7b2e0e8f51');
                    }

                    recursivelyAddSnippetToIframes(window);
                </script>
    </body>
</html>